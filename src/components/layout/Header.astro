---
import { menuLinks } from "@/site-config";

import Search from "../Search.astro";
import ThemeToggle from "../ThemeToggle.astro";

const url = new URL(Astro.request.url);
---

<header class="group relative mb-10 flex items-center sm:ps-[4.5rem]" id="main-header">
	<div class="flex sm:flex-col">
		<a
			aria-current={url.pathname === "/" ? "page" : false}
			class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
			href="/"
		>
			<svg
				aria-hidden="true"
				class="me-3 h-10 w-6 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-20 sm:w-12"
				xmlns="http://www.w3.org/2000/svg"
				enable-background="new 0 0 100 100"
				viewBox="0 20 95 95"
				version="1.1"
				xml:space="preserve"
				id="Machape"
			>
				<title>Machape</title>

				<circle cx="50" cy="71.75" id="svg_2" r="4.7"></circle>
				<path
					d="m94.77,66.97l-0.03,-0.1c-0.96,-3.29 -1.95,-6.7 -3.36,-9.63c-3.02,-6.23 -5.41,-10.87 -7.27,-14.15c1.66,-2.66 2.93,-5.52 3.79,-8.51c0.18,-0.6 4.19,-14.66 -1.22,-17.86c-1.33,-0.81 -2.78,-0.5 -5.2,0.01c-2.68,0.57 -5.05,1.56 -9.03,3.79c-1.73,0.98 -3.38,1.98 -5.02,3.02c-3.33,-1.96 -7.12,-3.27 -11.1,-3.93c-0.18,-0.07 -0.38,-0.12 -0.58,-0.12c-0.03,0 -0.06,0.01 -0.09,0.01c-1.8,-0.26 -3.62,-0.41 -5.45,-0.41c-0.07,-0.01 -0.14,-0.02 -0.21,-0.02c-0.11,0 -0.22,0.01 -0.32,0.03c-5.99,0.08 -12.01,1.56 -17.11,4.44c-1.64,-1.04 -3.29,-2.04 -5.03,-3.02c-3.98,-2.23 -6.34,-3.22 -9.05,-3.8c-2.39,-0.5 -3.84,-0.81 -5.16,-0.01c-5.42,3.21 -1.41,17.27 -1.23,17.86c0.86,3 2.13,5.86 3.79,8.52c-1.86,3.28 -4.25,7.92 -7.27,14.15c-1.41,2.93 -2.4,6.34 -3.36,9.63l-0.03,0.1c-0.53,1.83 -0.12,3.78 1.09,5.24c1.22,1.46 3.08,2.22 4.99,2.02c2.39,-0.24 5.4,-0.44 9.61,-0.09l2.16,0.18c5.03,0.41 6.65,0.54 11.28,1.44c1.91,1.62 4.47,3.59 7.74,5.04c0.98,0.43 1.95,0.82 2.86,1.13c1.63,0.56 3.33,0.84 5.04,0.84s3.41,-0.28 5.03,-0.84c0.92,-0.31 1.89,-0.7 2.87,-1.13c3.27,-1.45 5.83,-3.42 7.73,-5.04c4.64,-0.9 6.25,-1.03 11.28,-1.44l2.17,-0.18c4.2,-0.35 7.22,-0.15 9.61,0.09c1.91,0.2 3.77,-0.56 4.99,-2.02c1.21,-1.46 1.62,-3.41 1.09,-5.24zm-60.27,-10.99c0,-1.66 1.34,-3 3,-3s3,1.34 3,3s-1.34,3 -3,3s-3,-1.35 -3,-3zm28,3c-1.66,0 -3,-1.34 -3,-3s1.34,-3 3,-3s3,1.34 3,3s-1.34,3 -3,3zm28.88,11.3c-0.6,0.71 -1.46,1.06 -2.38,0.97c-1.14,-0.12 -2.41,-0.22 -3.87,-0.27c-0.31,-0.61 -0.62,-1.26 -0.96,-1.95c-1.89,-3.9 -4.25,-8.75 -8.61,-13.15c-4.97,-5.02 -8.79,-7.17 -12.18,-8.76c-0.67,-0.31 -1.39,-0.47 -2.13,-0.47c-1.97,0 -3.78,1.16 -4.61,2.95l-3.26,7.02c-1.11,2.41 -0.19,5.29 2.12,6.56c2.22,1.23 3.9,2.46 5.14,3.78c1.98,2.12 3.08,4.28 3.81,6.01c-0.17,0.06 -0.33,0.14 -0.47,0.26c-1.89,1.62 -4.23,3.47 -7.29,4.82c-0.91,0.41 -1.79,0.76 -2.63,1.05c-2.66,0.91 -5.46,0.91 -8.12,0c-0.84,-0.29 -1.72,-0.64 -2.63,-1.04c-3.06,-1.36 -5.4,-3.21 -7.29,-4.83c-0.05,-0.04 -0.11,-0.07 -0.17,-0.11c0.02,-0.07 0.05,-0.13 0.07,-0.2c0.61,-1.72 1.31,-3.67 3.45,-5.95c1.23,-1.32 2.91,-2.56 5.13,-3.79c2.31,-1.27 3.23,-4.15 2.12,-6.56l-3.26,-7.02c-0.83,-1.79 -2.64,-2.95 -4.61,-2.95c-0.74,0 -1.46,0.16 -2.13,0.47c-3.39,1.59 -7.21,3.75 -12.18,8.76c-4.36,4.4 -6.72,9.25 -8.61,13.15c-0.33,0.69 -0.65,1.34 -0.96,1.95c-1.45,0.05 -2.73,0.15 -3.87,0.27c-0.92,0.1 -1.79,-0.26 -2.38,-0.96c-0.58,-0.7 -0.76,-1.6 -0.51,-2.48l0.03,-0.1c0.93,-3.18 1.88,-6.46 3.18,-9.16c3.24,-6.69 5.74,-11.51 7.62,-14.75c0.29,-0.5 0.27,-1.11 -0.04,-1.59c-1.74,-2.62 -3.06,-5.47 -3.92,-8.47c-1.89,-6.48 -1.94,-13.37 -0.11,-14.46c0.32,-0.19 1.56,0.07 3.02,0.38c2.02,0.43 4.01,1.14 8.18,3.48c1.95,1.09 3.79,2.21 5.63,3.4c0.05,0.03 0.09,0.05 0.14,0.07c0.02,0.02 0.05,0.03 0.07,0.04c0.07,0.03 0.14,0.05 0.21,0.07c0.02,0.01 0.04,0.02 0.06,0.02c0.07,0.02 0.14,0.03 0.22,0.03c0.02,0 0.05,0.01 0.07,0.01c0.07,0 0.14,0 0.2,-0.01c0.03,0 0.07,-0.01 0.1,-0.01c0.06,-0.01 0.13,-0.03 0.19,-0.05c0.03,-0.01 0.06,-0.01 0.09,-0.03c0.07,-0.02 0.13,-0.06 0.2,-0.09c0.01,-0.01 0.03,-0.02 0.04,-0.02c4.5,-2.72 9.84,-4.2 15.21,-4.46l0,7.05c0,0.83 0.67,1.5 1.5,1.5s1.5,-0.67 1.5,-1.5l0,-7.06c0.92,0.04 1.84,0.1 2.74,0.21l0,1.62c0,0.83 0.68,1.5 1.5,1.5s1.5,-0.67 1.5,-1.5l0,-1.12c3.4,0.72 6.63,1.97 9.44,3.76c0.25,0.16 0.53,0.23 0.8,0.23c0.35,0 0.68,-0.12 0.96,-0.35c1.79,-1.16 3.58,-2.25 5.48,-3.31c4.18,-2.35 6.16,-3.05 8.2,-3.48c1.45,-0.31 2.69,-0.57 3.02,-0.37c1.82,1.08 1.77,7.97 -0.12,14.45c-0.86,3 -2.18,5.85 -3.92,8.47c-0.31,0.48 -0.33,1.09 -0.04,1.59c1.88,3.24 4.38,8.06 7.61,14.74c1.31,2.71 2.26,5.99 3.19,9.17l0.03,0.1c0.25,0.88 0.07,1.78 -0.51,2.47z"
					id="svg_3"></path>
				<path
					d="m18.07,22.58c-0.26,-0.09 -0.55,-0.07 -0.79,0.06c-0.24,0.13 -0.42,0.35 -0.49,0.62c-0.47,1.68 -0.34,5.35 1.01,9.75c0.79,2.54 1.72,4.55 2.84,6.15c0.19,0.25 0.48,0.41 0.8,0.42c0.01,0 0.01,0 0.02,0c0.31,0 0.6,-0.15 0.79,-0.39l6.81,-8.79c0.3,-0.39 0.27,-0.95 -0.08,-1.3c-2.79,-2.89 -6.26,-4.96 -10.91,-6.52z"
					id="svg_4"></path>
				<path
					d="m82.84,23.26c-0.07,-0.27 -0.25,-0.49 -0.5,-0.62c-0.24,-0.12 -0.52,-0.15 -0.78,-0.06c-4.65,1.56 -8.12,3.64 -10.92,6.52c-0.34,0.35 -0.38,0.91 -0.07,1.31l6.81,8.78c0.18,0.25 0.48,0.39 0.79,0.39c0,0 0.01,0 0.02,0c0.31,-0.01 0.61,-0.16 0.79,-0.42c1.13,-1.6 2.06,-3.6 2.84,-6.14c1.36,-4.41 1.49,-8.07 1.02,-9.76z"
					id="svg_5"></path>
			</svg>

			<span class="text-xl font-bold sm:text-2xl">Emilio Quinter√∏</span>
		</a>
		<nav
			aria-label="Main menu"
			class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={url.pathname === link.path ? "page" : false}
						class="px-4 py-4 sm:py-0 sm:hover:underline"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</nav>
	</div>

	<Search />
	<ThemeToggle />
	<mobile-button>
		<button
			aria-expanded="false"
			aria-haspopup="menu"
			aria-label="Open main menu"
			class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
				fill="none"
				focusable="false"
				id="line-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
				></path>
			</svg>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
				class="text-accent"
				fill="none"
				focusable="false"
				id="cross-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</mobile-button>
</header>

<script>
	import { toggleClass } from "@/utils";

	class MobileNavBtn extends HTMLElement {
		private headerEl: HTMLElement;
		private menuOpen: boolean;
		private mobileButtonEl: HTMLButtonElement;

		toggleMobileMenu = () => {
			toggleClass(this.headerEl, "menu-open");
			this.menuOpen = !this.menuOpen;
			this.mobileButtonEl.setAttribute("aria-expanded", this.menuOpen.toString());
		};

		constructor() {
			super();
			this.headerEl = document.getElementById("main-header")!;
			this.mobileButtonEl = this.querySelector("button") as HTMLButtonElement;
			this.menuOpen = false;

			this.mobileButtonEl.addEventListener("click", this.toggleMobileMenu);
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
